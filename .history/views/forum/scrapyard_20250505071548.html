<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>SCRAPYARD | Digital Wasteland Terminal</title>

  <!-- SEO Meta Tags -->
  <meta name="description" content="ELRIEL Scrapyard - A mystical collection of discarded code, forgotten artifacts, and broken tech from the digital wasteland. Explore the cyberpunk junkyard.">
  <meta name="keywords" content="ELRIEL, Scrapyard, artifacts, digital wasteland, cyberpunk, retro, glitch, digital archaeology">

  <!-- Open Graph / Social Media -->
  <meta property="og:type" content="website">
  <meta property="og:url" content="https://elriel.network/forum/scrapyard">
  <meta property="og:title" content="SCRAPYARD | Digital Wasteland Terminal">
  <meta property="og:description" content="A mystical collection of discarded code and broken tech. Explore digital artifacts from the wasteland.">
  
  <!-- Fonts -->
  <link href="https://fonts.googleapis.com/css2?family=VT323&family=Share+Tech+Mono&family=IBM+Plex+Mono&display=swap" rel="stylesheet">
  
  <!-- Stylesheets -->
  <link rel="stylesheet" href="/css/cyberpunk-terminal.css">
  <link rel="stylesheet" href="/css/forum.css">
  
  <!-- Scripts -->
  <script src="/js/error-logger.js" defer></script>
  <script src="/js/cyberpunk-terminal.js" defer></script>
</head>
<body class="terminal">
  <!-- Screen Effects -->
  <div class="noise-overlay"></div>
  <div class="scan-lines"></div>
  <div class="crt-effect"></div>
  
  <!-- Main Container -->
  <div class="container">
    <header class="main-header">
      <div class="logo">
        <h1 class="glitch" data-text="ELRIEL">ELRIEL</h1>
        <div class="logo-subtitle">DIGITAL WASTELAND v1.3.7</div>
      </div>
      <div class="user-panel">
        <div id="user-status">
          <!-- User status will be injected here -->
        </div>
      </div>
    </header>

    <div class="content-wrapper">
      <nav class="sidebar">
        <div class="nav-section">
          <h3 class="nav-title">MAIN SYSTEMS</h3>
          <ul class="nav-links">
            <li><a href="/">TERMINAL</a></li>
            <li><a href="/feed/bleedstream">BLEEDSTREAM</a></li>
            <li><a href="/glyph/crucible">GLYPH CRUCIBLE</a></li>
            <li><a href="/whisper/board">WHISPERBOARD</a></li>
            <li><a href="/forum/scrapyard" class="active">SCRAPYARD</a></li>
          </ul>
        </div>
        <div class="nav-section">
          <h3 class="nav-title">FORUM</h3>
          <ul class="nav-links">
            <li><a href="/forum">MAIN FORUMS</a></li>
            <li><a href="/forum/scrapyard" class="active">SCRAPYARD</a></li>
          </ul>
        </div>
        <div class="nav-section">
          <h3 class="nav-title">SYSTEM</h3>
          <ul class="nav-links">
            <li><a href="/about">ABOUT</a></li>
            <li><a href="#" id="toggle-glitch">TOGGLE GLITCH</a></li>
          </ul>
        </div>
      </nav>

      <main class="main-content">
        <!-- System Log Sidebar -->
        <aside class="system-log-sidebar">
          <div class="panel-header">
            <h2>SCRAP LOG</h2>
            <div class="status-indicator">LIVE</div>
          </div>
          <div class="panel-content" id="system-log">
            <div class="log-entry">
              <span class="log-time">06:52:32</span>
              <span class="log-text">Scanning sector 7 for artifacts</span>
            </div>
            <div class="log-entry">
              <span class="log-time">06:55:48</span>
              <span class="log-text">Hardware signature detected</span>
            </div>
            <div class="log-entry">
              <span class="log-time">06:58:19</span>
              <span class="log-text">User [REDACTED] salvaged artifact #405</span>
            </div>
            <div class="log-entry">
              <span class="log-time">07:01:05</span>
              <span class="log-text">Decoding fragmented memory block</span>
            </div>
            <div class="log-entry">
              <span class="log-time">07:04:22</span>
              <span class="log-text">Analysis complete: 73% recovery</span>
            </div>
            <div class="log-entry">
              <span class="log-time">07:08:14</span>
              <span class="log-text">New artifact classification pending</span>
            </div>
          </div>
        </aside>

        <!-- Main Scrapyard Panel -->
        <section class="panel scrapyard-panel">
          <div class="scanner-line"></div>
          <div class="panel-header">
            <h2>SCRAPYARD ACCESS</h2>
            <div class="status-indicator alert">ACTIVE</div>
          </div>
          <div class="panel-content">
            <div class="scrapyard-intro">
              <div class="scrapyard-icon">
                <svg viewBox="0 0 100 100" xmlns="http://www.w3.org/2000/svg">
                  <defs>
                    <radialGradient id="glow" cx="50%" cy="50%" r="50%" fx="50%" fy="50%">
                      <stop offset="0%" stop-color="#ff0000" stop-opacity="0.3"/>
                      <stop offset="100%" stop-color="#330000" stop-opacity="0"/>
                    </radialGradient>
                  </defs>
                  <circle cx="50" cy="50" r="48" fill="url(#glow)"/>
                  <circle cx="50" cy="50" r="45" fill="none" stroke="#ff0033" stroke-width="2"/>
                  <path d="M30,30 L70,70" stroke="#ff0033" stroke-width="2"/>
                  <path d="M70,30 L30,70" stroke="#ff0033" stroke-width="2"/>
                  <circle cx="50" cy="50" r="20" fill="none" stroke="#ff0033" stroke-width="1"/>
                  <text x="38" y="55" font-family="monospace" font-size="12" fill="#ff0033">01</text>
                </svg>
              </div>
              <div class="scrapyard-description">
                <h2 class="glitch-effect" data-text="SCRAPYARD">SCRAPYARD</h2>
                <p>Welcome to the digital junkyard—a wasteland collection point for discarded code, forgotten artifacts, and broken tech from the digital ruins. Here, scavengers exchange and catalog the debris of the network—each piece with its own history and hidden power.</p>
                <div id="scrapyard-controls">
                  <a href="/forum/scrapyard" class="button hover-glow">SCAN YARD</a>
                  <a href="/forum/scrapyard/new" class="button hover-glow">DEPOSIT ARTIFACT</a>
                </div>
              </div>
            </div>
            
            <div class="scrapyard-listing" id="scrapyard-items">
              <!-- Scrapyard items will be injected here -->
              <div class="loading-indicator">INITIALIZING ARTIFACT SCAN</div>
            </div>
          </div>
        </section>
        
        <!-- Artifact Registry -->
        <section class="panel ascii-panel">
          <div class="scanner-line"></div>
          <div class="panel-header">
            <h2>ARTIFACT REGISTRY</h2>
            <div class="status-indicator">ARCHIVE</div>
          </div>
          <div class="panel-content ascii-content">
            <pre class="ascii-art">
  .--.      .--.      .--.      .--.      .--.      .--.
:::::.\::::::::.\::::::::.\::::::::.\::::::::.\::::::::.\
'      `--'      `--'      `--'      `--'      `--'      `
</pre>
            <div class="registry-stats">
              <div class="stat-block">
                <div class="stat-value" id="artifact-count">--</div>
                <div class="stat-label">ARTIFACTS</div>
              </div>
              <div class="stat-block">
                <div class="stat-value" id="scrap-count">--</div>
                <div class="stat-label">ANALYSES</div>
              </div>
              <div class="stat-block">
                <div class="stat-value" id="active-scavengers">--</div>
                <div class="stat-label">SCAVENGERS</div>
              </div>
            </div>
          </div>
        </section>
      </main>
    </div>

    <footer class="main-footer">
      <div class="footer-text">ELRIEL NETWORK // ESTABLISHED 2025 // ALL RIGHTS SURRENDERED</div>
      <div class="footer-glyphs">
        <span class="glyph" data-symbol="command">⌘</span>
        <span class="glyph" data-symbol="star">⍟</span>
        <span class="glyph" data-symbol="node">⎔</span>
      </div>
    </footer>
  </div>

  <script>
    document.addEventListener('DOMContentLoaded', function() {
      console.log('[SCRAPYARD] Initializing terminal interface...');
      
      // Initialize all scrapyard components
      initBootstrapSequence();
      initScrapyardData();
      initScrapLog();
      initRegistryStats();
      
      // Add event listeners
      addEventListeners();
      
      // Dispatch system ready event
      setTimeout(() => {
        console.log('[SCRAPYARD] All systems operational.');
        document.dispatchEvent(new CustomEvent('scrapyardReady'));
      }, 1000);
    });
    
    /**
     * Bootstrap sequence - initial loading animation
     */
    function initBootstrapSequence() {
      // Create a visual effect when entering the scrapyard
      const bootstrapEffect = () => {
        document.body.classList.add('glitch-active');
        setTimeout(() => {
          document.body.classList.remove('glitch-active');
        }, 500);
      };
      
      // Add delayed bootstrap visual effect
      setTimeout(bootstrapEffect, 300);
      setTimeout(bootstrapEffect, 1200);
    }
    
    /**
     * Initialize scrapyard data and user information
     */
    function initScrapyardData() {
      // Parse injected data with error handling
      let data = {};
      try {
        // Inject data from server
        data = __DATA__;
        console.log("[SCRAPYARD] Data loaded successfully:", {
          itemCount: data.items ? data.items.length : 0,
          hasUser: !!data.user
        });
      } catch (err) {
        console.error("[SCRAPYARD] Error parsing injected data:", err);
        data = { items: [] };
      }
      
      // Store for later use
      window.scrapyardData = data;
      
      // Update user status in header
      const userStatusEl = document.getElementById('user-status');
      if (data.user) {
        userStatusEl.innerHTML = `
          <div class="logged-in">
            <span class="username">${data.user.username}</span>
            <div class="user-links">
              <a href="/profile" class="button">PROFILE</a>
              <a href="/auth/logout" class="button">LOGOUT</a>
            </div>
          </div>
        `;
      } else {
        userStatusEl.innerHTML = `
          <div class="logged-out">
            <a href="/auth/login" class="button login-btn">LOGIN</a>
            <a href="/auth/register" class="button register-btn">REGISTER</a>
          </div>
        `;
      }
      
      // Populate artifact registry stats
      updateRegistryStats(data);
      
      // Populate scrapyard items with animation sequence
      populateScrapyardItems(data);
    }
    
    /**
     * Populate scrapyard items with staggered animation
     */
    function populateScrapyardItems(data) {
      const scrapyardItems = document.getElementById('scrapyard-items');
      
      // Show loading first
      scrapyardItems.innerHTML = `<div class="loading-indicator">INITIALIZING ARTIFACT SCAN</div>`;
      
      // Delay to show the animation
      setTimeout(() => {
        if (data.items && data.items.length > 0) {
          // Create a document fragment for better performance
          const fragment = document.createDocumentFragment();
          
          // Clear loading indicator
          scrapyardItems.innerHTML = '';
          
          // Add scrapyard grid
          const grid = document.createElement('div');
          grid.className = 'scrapyard-grid';
          
          // Add each item with staggered animation
          data.items.forEach((item, index) => {
            const itemDate = new Date(item.created_at).toLocaleDateString();
            const lastActivity = item.last_activity ? new Date(item.last_activity).toLocaleDateString() : itemDate;
            
            // Create item element
            const itemEl = document.createElement('div');
            itemEl.className = 'scrapyard-item';
            itemEl.style.animationDelay = `${index * 0.15}s`;
            
            // Create artifact SVG mark
            const artifactId = (item.id % 1000).toString().padStart(3, '0');
            
            // Item HTML
            itemEl.innerHTML = `
              <div class="scanner-line"></div>
              <div class="panel-header">
                <h3>${item.title}</h3>
                <div class="artifact-id">#${artifactId}</div>
              </div>
              <div class="panel-content">
                <div class="artifact-pattern">
                  <svg viewBox="0 0 100 100" class="artifact-symbol">
                    <circle cx="50" cy="50" r="40" fill="none" stroke="var(--terminal-green)" stroke-width="1" />
                    <path d="M${20 + (item.id % 30)} ${20 + (item.id % 20)} L${50 + (item.id % 20)} ${70 - (item.id % 30)}" stroke="var(--terminal-green)" stroke-width="1" />
                    <path d="M${80 - (item.id % 25)} ${30 + (item.id % 15)} L${30 + (item.id % 25)} ${60 + (item.id % 10)}" stroke="var(--terminal-green)" stroke-width="1" />
                    <text x="40" y="55" font-family="monospace" font-size="10" fill="var(--terminal-green)">${artifactId}</text>
                  </svg>
                </div>
                <div class="artifact-info">
                  <div class="scrapyard-item-meta">
                    <span class="artifact-founder">FOUNDER: ${item.username}</span>
                    <span class="artifact-date">DISCOVERED: ${itemDate}</span>
                  </div>
                  <div class="scrapyard-item-description">
                    ${item.content.substring(0, 100)}...
                  </div>
                </div>
                <div class="scrapyard-item-footer">
                  <div class="artifact-stats">
                    <span class="comment-count">ANALYSES: ${item.comment_count}</span>
                    <span class="last-activity">LAST SIGNAL: ${lastActivity}</span>
                  </div>
                  <a href="/forum/topic/${item.id}" class="button hover-glow">EXAMINE</a>
                </div>
              </div>
            `;
            
            // Add interactive effects
            itemEl.addEventListener('mouseover', function() {
              addScrapLog(`Scanning artifact #${artifactId}`);
            });
            
            itemEl.addEventListener('click', function(e) {
              if (e.target.tagName !== 'A') {
                // Add glitch effect when clicking
                itemEl.classList.add('glitch-text');
                setTimeout(() => {
                  window.location.href = `/forum/topic/${item.id}`;
                }, 300);
              }
            });
            
            // Add to grid
            grid.appendChild(itemEl);
          });
          
          // Add grid to document
          fragment.appendChild(grid);
          scrapyardItems.appendChild(fragment);
          
        } else {
          // Show empty state
          scrapyardItems.innerHTML = `
            <div class="empty-state">
              <div class="empty-icon">⨯</div>
              <div class="empty-message">NO ARTIFACTS DETECTED</div>
              <div class="empty-subtitle">Signal is weak today. Be the first to add something from the digital wasteland.</div>
            </div>
          `;
        }
      }, 1500); // Delay for dramatic effect
    }
    
    /**
     * Initialize scrap log with dynamic updates
     */
    function initScrapLog() {
      const systemLog = document.getElementById('system-log');
      if (!systemLog) return;
      
      // Possible log messages for scrapyard
      const possibleLogs = [
        'Artifact #%d data corruption: %d%',
        'Unknown technology signature in sector %d',
        'Digital archive fragment recovered',
        'Salvage crew dispatched to coordinate %s',
        'Memory crystal degradation: %d%',
        'Foreign data structures detected',
        'Scavenger %s reported anomalous readings',
        'Signal degradation in artifact #%d',
        'New pattern recognized in scrap heap',
        'Salvaging operation in progress: %d%'
      ];
      
      // Random string generator
      const randomString = () => {
        const chars = 'ABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789';
        return Array(3).fill().map(() => chars.charAt(Math.floor(Math.random() * chars.length))).join('');
      };
      
      // Format log message with random values
      const formatLogMessage = (message) => {
        return message
          .replace('%d', Math.floor(Math.random() * 100))
          .replace('%s', randomString());
      };
      
      // Add new log periodically
      setInterval(() => {
        if (Math.random() < 0.3) { // 30% chance to add a new log
          const currentTime = new Date();
          const timeString = currentTime.toLocaleTimeString('en-US', {
            hour12: false,
            hour: '2-digit',
            minute: '2-digit',
            second: '2-digit'
          });
          
          const logMessage = possibleLogs[Math.floor(Math.random() * possibleLogs.length)];
          const formattedMessage = formatLogMessage(logMessage);
          
          const logEntry = document.createElement('div');
          logEntry.className = 'log-entry';
          logEntry.innerHTML = `
            <span class="log-time">${timeString}</span>
            <span class="log-text">${formattedMessage}</span>
          `;
          
          // Add to top of log
          systemLog.insertBefore(logEntry, systemLog.firstChild);
          
          // Remove old logs if too many
          if (systemLog.children.length > 15) {
            systemLog.removeChild(systemLog.lastChild);
          }
        }
      }, 5000); // Check every 5 seconds
    }
    
    /**
     * Add a message to the scrap log
     */
    function addScrapLog(message) {
      const systemLog = document.getElementById('system-log');
      if (!systemLog) return;
      
      const currentTime = new Date();
      const timeString = currentTime.toLocaleTimeString('en-US', {
        hour12: false,
        hour: '2-digit',
        minute: '2-digit',
        second: '2-digit'
      });
      
      const logEntry = document.createElement('div');
      logEntry.className = 'log-entry';
      logEntry.innerHTML = `
        <span class="log-time">${timeString}</span>
        <span class="log-text">${message}</span>
      `;
      
      // Add with highlight effect
      logEntry.classList.add('highlight');
      setTimeout(() => {
        logEntry.classList.remove('highlight');
      }, 2000);
      
      // Add to top of log
      systemLog.insertBefore(logEntry, systemLog.firstChild);
      
      // Remove old logs if too many
      if (systemLog.children.length > 15) {
        systemLog.removeChild(systemLog.lastChild);
      }
    }
    
    /**
     * Initialize registry stats counter animation
     */
    function initRegistryStats() {
      // Create counter animation function
      function animateCounter(element, targetValue) {
        if (!element) return;
        
        const duration = 2000; // 2 seconds
        const startTime = performance.now();
        const startValue = 0;
        
        function updateCounter(currentTime) {
          const elapsedTime = currentTime - startTime;
          const progress = Math.min(elapsedTime / duration, 1);
          const easedProgress = progress < 0.5
                              ? 4 * progress * progress * progress
                              : 1 - Math.pow(-2 * progress + 2, 3) / 2; // Cubic easing
          
          const currentValue = Math.floor(startValue + (targetValue - startValue) * easedProgress);
          element.textContent = currentValue;
          
          if (progress < 1) {
            requestAnimationFrame(updateCounter);
          }
        }
        
        requestAnimationFrame(updateCounter);
      }
      
      // Delay animation start for dramatic effect
      setTimeout(() => {
        // Get data from window store
        const data = window.scrapyardData || {};
        
        // Calculate stats
        const artifactCount = data.items ? data.items.length : 0;
        const scrapCount = data.items ? data.items.reduce((sum, item) => sum + (item.comment_count || 0), 0) : 0;
        const activeScavengers = data.activeUsers || Math.floor(Math.random() * 10) + 5; // Fallback to random number
        
        // Start animation
        animateCounter(document.getElementById('artifact-count'), artifactCount);
        animateCounter(document.getElementById('scrap-count'), scrapCount);
        animateCounter(document.getElementById('active-scavengers'), activeScavengers);
      }, 1500);
    }
    
    /**
     * Update registry stats from data
     */
    function updateRegistryStats(data) {
      // Store statistics
      const artifactCount = data.items ? data.items.length : 0;
      const scrapCount = data.items ? data.items.reduce((sum, item) => sum + (item.comment_count || 0), 0) : 0;
      const activeScavengers = data.activeUsers || Math.floor(Math.random() * 10) + 5; // Fallback to random
      
      // Store in global data
      if (!window.scrapyardData) window.scrapyardData = {};
      window.scrapyardData.stats = {
        artifactCount,
        scrapCount,
        activeScavengers
      };
    }
    
    /**
     * Add event listeners for interactive elements
     */
    function addEventListeners() {
      // Toggle glitch effects
      const glitchToggle = document.getElementById('toggle-glitch');
      if (glitchToggle) {
        glitchToggle.addEventListener('click', function(e) {
          e.preventDefault();
          document.body.classList.toggle('glitch-active');
          
          // Use the terminal glitch sound if available
          if (window.elrielTerminal && window.elrielTerminal.playGlitchSound) {
            window.elrielTerminal.playGlitchSound();
          }
          
          // Add log entry
          addScrapLog('Glitch system ' + (document.body.classList.contains('glitch-active') ? 'activated' : 'deactivated'));
        });
      }
      
      // Scrapyard controls
      const refreshButton = document.querySelector('#scrapyard-controls a:first-child');
      if (refreshButton) {
        refreshButton.addEventListener('click', function(e) {
          // Don't prevent default navigation, but add effects
          document.body.classList.add('glitch-active');
          setTimeout(() => {
            document.body.classList.remove('glitch-active');
          }, 300);
          
          // Add log message
          addScrapLog('Initiating fresh scan of scrapyard sector');
        });
      }
      
      const addButton = document.querySelector('#scrapyard-controls a:last-child');
      if (addButton) {
        addButton.addEventListener('click', function(e) {
          // Don't prevent default navigation, but add effects
          document.body.classList.add('glitch-active');
          setTimeout(() => {
            document.body.classList.remove('glitch-active');
          }, 300);
          
          // Add log message
          addScrapLog('Preparing artifact deposit protocols');
        });
      }
    }
  </script>
</body>
</html>